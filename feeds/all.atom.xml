<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Шаманский блог</title><link href="/" rel="alternate"></link><link href="/feeds/all.atom.xml" rel="self"></link><id>/</id><updated>2016-12-05T23:00:00+03:00</updated><entry><title>Прикручиваем Яндеск.Метрику к pelican правильно.</title><link href="/prikruchivaem-iandeskmetriku-k-pelican-pravilno.html" rel="alternate"></link><updated>2016-12-05T23:00:00+03:00</updated><author><name>Николай Шаманович</name></author><id>tag:,2016-12-05:prikruchivaem-iandeskmetriku-k-pelican-pravilno.html</id><summary type="html">&lt;p&gt;Попытался найти в интернете как приделать Метрику к своему блогу,
но находил только решения типа — приколоти на гвозди вот тут,
и так сойдет. Короче решил разобраться и сделать все как надо.&lt;/p&gt;
&lt;p&gt;Для начала генерируем html код счетчика согласно официальной инструкции:
&lt;a class="reference external" href="https://yandex.ru/support/metrika/quick-start.xml"&gt;https://yandex.ru/support/metrika/quick-start.xml&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Открываем publishconf.py.
В нем создаем новый параметр, в котором будет храниться номер вашего счетчика&lt;/p&gt;
&lt;p&gt;Например так:&lt;/p&gt;
&lt;p&gt;YANDEX_METRIKA = &amp;quot;41353264&amp;quot;&lt;/p&gt;
&lt;p&gt;Затем нужно доработать тему.&lt;/p&gt;
&lt;p&gt;Моя тема хранится в паке блога в themes/shmblog/ и это по сути копия
стандартной темы.&lt;/p&gt;
&lt;p&gt;Добавляем новый шаблон &lt;em&gt;themes/shmblog/templates/metrika.html&lt;/em&gt;&lt;/p&gt;
&lt;pre class="literal-block"&gt;
{% if YANDEX_METRIKA %}
&amp;lt;!-- Yandex.Metrika counter --&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter{{YANDEX_METRIKA}} = new Ya.Metrika({
                    id: {{YANDEX_METRIKA}},
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName(&amp;quot;script&amp;quot;)[0],
            s = d.createElement(&amp;quot;script&amp;quot;),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = &amp;quot;text/javascript&amp;quot;;
        s.async = true;
        s.src = &amp;quot;https://mc.yandex.ru/metrika/watch.js&amp;quot;;

        if (w.opera == &amp;quot;[object Opera]&amp;quot;) {
            d.addEventListener(&amp;quot;DOMContentLoaded&amp;quot;, f, false);
        } else { f(); }
    })(document, window, &amp;quot;yandex_metrika_callbacks&amp;quot;);
&amp;lt;/script&amp;gt;
&amp;lt;noscript&amp;gt;&amp;lt;div&amp;gt;&amp;lt;img src=&amp;quot;https://mc.yandex.ru/watch/{{YANDEX_METRIKA}}&amp;quot; style=&amp;quot;position:absolute; left:-9999px;&amp;quot; alt=&amp;quot;&amp;quot; /&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/noscript&amp;gt;
&amp;lt;!-- /Yandex.Metrika counter --&amp;gt;
{% endif %}
&lt;/pre&gt;
&lt;p&gt;Это тот самый код, который нам генерирует Яндекс,
только код счетчика заменен на {{YANDEX_METRIKA}}.&lt;/p&gt;
&lt;p&gt;Далее правим основной шаблон. &lt;em&gt;themes/shmblog/templates/base.html&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Дописываем куда-нибудь в конец строку:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
{% include 'metrika.html' %}
&lt;/pre&gt;
&lt;p&gt;Ну теперь все, проверяем. Запускаем сервер и генерируем сайт с продакшн
настройками.&lt;/p&gt;
&lt;pre class="literal-block"&gt;
make publish &amp;amp;&amp;amp; make serve
&lt;/pre&gt;
&lt;p&gt;Естественно локально сайт будет выглядеть криво,
главное найти найти в конце странице наш код метрики и сравнить его с тем,
что сгенерировал Яндекс.
Если все верно, то можно публиковать.&lt;/p&gt;
&lt;p&gt;P.S.
Статистика на сайте обновляется примерно раз в полчаса,
адблоки могут блокировать работу метрики.&lt;/p&gt;
</summary><category term="pelican"></category><category term="howto"></category><category term="yandex.metrika"></category><category term="web"></category><category term="Яндекс.Метрика"></category></entry><entry><title>На что способен сервер за 500 рублей. Обзор и тестирование</title><link href="/na-chto-sposoben-server-za-500-rublei-obzor-i-testirovanie.html" rel="alternate"></link><updated>2016-11-29T12:00:00+03:00</updated><author><name>Николай Шаманович</name></author><id>tag:,2016-11-29:na-chto-sposoben-server-za-500-rublei-obzor-i-testirovanie.html</id><summary type="html">&lt;p&gt;Попался мне тут в руки один ретросервер. Приобрел я его на всеми любимом авито всего за 500 рублей.
По сути мне нужен был только корпус, все что было внутри его продавец отдал мне в качестве подарка.&lt;/p&gt;
&lt;p&gt;&lt;img alt="server_0" src="images/server_0.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;Собственно за 500 рублей я получил только корпус с бекплейтом, материнку, 2 процессора, привод CD-ROM, флоппик,
и 4 SCSI диска. Весела эта штука порядка 25 килограмм и пер я ее долго и
упорно почти через весь город, но это не так важно...
Притащил эту штуку домой, разобрал, почистил, снова собрал, и где-то в процессе всех этих действий у меня
возникло дикое желание запустить данный аппарат и посмотреть на что он способен.&lt;/p&gt;
&lt;p&gt;&lt;img alt="server_3" src="images/server_3.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;Недостающие компоненты были куплены на не менее любимом всеми ebay, тоже достаточно дешево,
и вот почти через месяц приехали ко мне. Можно собирать.&lt;/p&gt;
&lt;p&gt;Конфигурация получилась такая:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;материнская плата intel se7520bd2;&lt;/li&gt;
&lt;li&gt;пара процессоров intel xeon dp2800/2mb/800;&lt;/li&gt;
&lt;li&gt;4 планки памяти неизвестного производителя DDR-266 по 2Гб, всего получилось 8Гб;&lt;/li&gt;
&lt;li&gt;4 диска Seageate Cheetah 10K.7 ST373207LC по 80 Gb каждый;&lt;/li&gt;
&lt;li&gt;блок питания Rosewill Hiwe-1000, могучий киловатник.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;С блоком питания тут явный перебор, но он предназначается совсем другому серверу.
Также для проверки воткнул видекарту Radeon 9250 и звуковуху Sound blaster live! 5.1.&lt;/p&gt;
&lt;p&gt;&lt;img alt="server_1" src="images/server_1.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;После запуска сервер начал довольно сильно шуметь вентиляторами и дисками, а рейд-контроллер
начал пищать на все лады. Картинка на мониторе появилась только после пары минут.&lt;/p&gt;
&lt;p&gt;&lt;img alt="server_2" src="images/server_2.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;Нерабочими оказались только пара дисков, я их вынул, а из оставшихся двух собрал RAID 1.
Все остальное железо вроде бы функционирует исправно.&lt;/p&gt;
&lt;p&gt;Быстренько пробежимся по возможностям этого сервера - он умеет в PXE, Hyper-threading, EFI32, также
у него в биое присутствует дополнительная вкладка SERVER, а также там можно посмотреть
какие слоты памяти активны.&lt;/p&gt;
&lt;p&gt;&lt;img alt="server_4" src="images/server_4.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;Попытка установить Windows XP успехом не увенчалась, при попытке установки драйвера рейда
я стабильно вываливался в синий экран. Пользуясь случаем передаю привет MS.&lt;/p&gt;
&lt;p&gt;Debian 8 установилась по PXE без вопросов, хотя ставилась довольно долго, порядка двух часов.&lt;/p&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;Тесты&lt;/h2&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;Список тестов&lt;/h3&gt;
&lt;ol class="arabic simple" start="0"&gt;
&lt;li&gt;Тест архиватора bzip2. Архивация установочника дебиана.&lt;/li&gt;
&lt;li&gt;Тест архиватора pbzip2. Архивация установочника дебиана.&lt;/li&gt;
&lt;li&gt;Тест архиватора zpaq. Архивация установочника дебиана.&lt;/li&gt;
&lt;li&gt;Тест компиляции. Компиляция ядра Линукс на дефолтном конфиге.&lt;/li&gt;
&lt;li&gt;Тест LinPack (Intel® MKL Benchmarks).&lt;/li&gt;
&lt;li&gt;Тест sysbench память&lt;/li&gt;
&lt;li&gt;Тест sysbench процессор&lt;/li&gt;
&lt;li&gt;Тест диска hdparm -t /dev/sda&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h3&gt;Методика тестирования&lt;/h3&gt;
&lt;p&gt;Тесты прогонял один за другим с включенным и выключенным Hyper-threading
таким образом можно протестировать не только сам сервер, а еще и то
полезен или вреден Hyper-threading. В тестах архивации был использован
установочный образ debian-8.1.0-amd64-i386-netinst весом 555 Мб.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="bzip2"&gt;
&lt;h3&gt;Тест архиватора bzip2. Архивация установочника дебиана.&lt;/h3&gt;
&lt;p&gt;Архивировал с параметром --fast.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с Hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без Hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;192.14 сек.&lt;/td&gt;
&lt;td&gt;192.47 сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Собственно Hyper-threading не влияет на bzip2 никак.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pbzip2"&gt;
&lt;h3&gt;Тест архиватора pbzip2. Архивация установочника дебиана.&lt;/h3&gt;
&lt;p&gt;Паралельная версия bzip2. Тоже --fast.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;85.57 сек.&lt;/td&gt;
&lt;td&gt;101.74 сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;В этом тесте Hyper-threading оказался весьма полезным.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="zpaq"&gt;
&lt;h3&gt;Тест архиватора zpaq. Архивация установочника дебиана.&lt;/h3&gt;
&lt;p&gt;Великий и могучий сжиматель. Архивировал с дефолтными параметрами.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;4024 сек.&lt;/td&gt;
&lt;td&gt;4083 сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Параллельного pzpaq в репозитории не обнаружил, но я думаю что будет то же самое что и с bzip2 pbzip2.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;Тест компиляции. Компиляция ядра Линукс на дефолтном конфиге.&lt;/h3&gt;
&lt;p&gt;В этом тесте я также решил найти определить оптимальное количество потоков для компиляции.
В gentoo.wiki сказано что потоков должно быть на 1 больше, чем количество ядер процессоров.&lt;/p&gt;
&lt;p&gt;&lt;img alt="bench_0" src="images/bench_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;В моем случае лучшие результаты достигаются при колличестве потоко роному количеству ядер, т.е.
4 и 2 при включенном и выключенным Hyper-threading соответственно.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="47%" /&gt;
&lt;col width="53%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading 4 потока&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading 2 потока&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;1158 сек.&lt;/td&gt;
&lt;td&gt;1323 сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Тут hyper-threading снова оказывается весьма полезным.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="linpack-intel-mkl-benchmarks"&gt;
&lt;h3&gt;Тест LinPack (Intel® MKL Benchmarks).&lt;/h3&gt;
&lt;p&gt;Тут я прогонял только бинарный тест. Собрать из сорцов у меня не получилось, прошу меня за это простить.
Бинраный тест запускается на двух потоках.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;4.972 Gflops&lt;/td&gt;
&lt;td&gt;5.216 Gflops&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Этот тест показывает, что все таки Hyper-threading не всегда полезный.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="sysbench"&gt;
&lt;h3&gt;Тест sysbench память&lt;/h3&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;1095 Mb/сек.&lt;/td&gt;
&lt;td&gt;1100 Mb/сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;На результаты этого теста Hyper-threading не влияет, как и количество потоков.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h3&gt;Тест sysbench процессор&lt;/h3&gt;
&lt;p&gt;&lt;img alt="bench_1" src="images/bench_0.png" /&gt;&lt;/p&gt;
&lt;p&gt;Лучшие результаты также как и в тесте с компиляцией получаются на 2 и 4 потоках.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="47%" /&gt;
&lt;col width="53%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading 4 потока&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading 2 потока&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;10.4 сек.&lt;/td&gt;
&lt;td&gt;12.6 сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="hdparm-t-dev-sda"&gt;
&lt;h3&gt;Тест диска hdparm -t /dev/sda&lt;/h3&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="46%" /&gt;
&lt;col width="54%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;с hyper-threading&lt;/th&gt;
&lt;th class="head"&gt;без hyper-threading&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;75.11 Mb/сек.&lt;/td&gt;
&lt;td&gt;73.8 Mb/сек.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id7"&gt;
&lt;h2&gt;Заключение&lt;/h2&gt;
&lt;p&gt;Данный аппарат является очень интересной железкой и им в принципе можно пользоваться до сих пор,
но уж больно он шумный и иногда предательски фризит, все таки годы берут свое.
В любом случае этот сервер и результаты тестирования послужат хорошей отправной
точкой для обзора других моих железок. Я надеюсь, что данная статья была интересной или даже полезной.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="hardware"></category><category term="retro"></category><category term="benchmark"></category><category term="xeon"></category><category term="Intel"></category><category term="Linux"></category><category term="железо"></category><category term="ретро"></category><category term="сервер"></category></entry></feed>